<link rel="import" href="search-box.html">

<dom-module id="film-search">

  <template>
    <style>
      :host {
        display: block;
      }
    </style>

    <p>Buscador de películas</p>
    <search-box placeholder="Buscar película..."></search-box>
    <p>longitud array pelis: [[films.length]]</p>
    
    <template is="dom-if" if="{{_areThereFilms(films)}}">
      mostrar listado de peliculas!
    </template>

  </template>

  <script>
    class FilmSearch extends Polymer.Element {

      static get is() { return "film-search"; }
      static get properties() {
        return {
          films: {
            type: Array,
            value: function () { return []; }
          }
        }
      }

      ready() {
        super.ready();
        this.addEventListener('searchFilm', this._searchFilm);
      }

      _searchFilm(event) {
        console.log('please find this film!: ' + event.detail.value);
        this._findFilms(event.detail.value);
      }

      _findFilms(film) {
        const url = `http://www.omdbapi.com/?s=${film}&plot=full&apikey=e477ed6a`
        fetch(url)
          .then((resp) => resp.json())
          .then((data) => { this.set('films', data.Search) })
          .catch((error) => { console.log(error) });
      }

      _areThereFilms(films) {
        return !!films.length;
      }
    }
    customElements.define(FilmSearch.is, FilmSearch);
  </script>

</dom-module>